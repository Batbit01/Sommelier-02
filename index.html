<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title id="vinoTitle">Ficha del Vino</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; background-color: #fefefe; color: #222; max-width: 600px; margin: auto; }
    .vino-ficha img { width: 100%; max-height: 300px; object-fit: contain; border-radius: 1rem; }
    .vino-dato { margin-bottom: 1rem; }
    .vino-dato strong { display: inline-block; width: 100px; }
    #respuesta { margin-top: 2rem; font-style: italic; background: #f1f1f1; padding: 1rem; border-radius: 0.5rem; }
    #hablar { display: inline-block; margin-top: 2rem; padding: 0.75rem 1.5rem; background: #800000; color: white; border: none; border-radius: 1rem; cursor: pointer; }
    #score-container, #valoracion-container { margin-top: 3rem; }
    #score-bar { width: 100%; height: 20px; background-color: #ddd; border-radius: 10px; overflow: hidden; }
    #score-fill { height: 100%; background-color: #800000; text-align: center; line-height: 20px; color: white; font-size: 0.9rem; }
    #estrellas .estrella { font-size: 2rem; color: #ccc; cursor: pointer; }
    #estrellas .estrella.seleccionada { color: #800000; }
    #estrellas-nota { color: #800000; font-size: 1.8rem; vertical-align: middle; }
    #lista-comentarios .comentario { margin-bottom: 1rem; padding: 0.75rem; border: 1px solid #ddd; border-radius: 0.5rem; background-color: #fafafa; text-align: left; }

    /* ----- Módulo redes sociales ----- */
    .modulo-redes {
      margin: 1.1rem 0 1.1rem 0;
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 0.6rem 0.1rem 0.6rem 0.1rem;
    }
    .redes-scroll {
      display: flex;
      flex-direction: row;
      gap: 1.5rem;
      width: 100%;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .redes-scroll::-webkit-scrollbar { display: none; }
    .red-social-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: #fff;
      box-shadow: 0 2px 12px #80000011;
      border: 2.2px solid #f0e6e6;
      cursor: pointer;
      transition: transform 0.12s, box-shadow 0.13s;
      font-size: 0.88rem;
      text-decoration: none;
    }
    .red-social-btn:hover, .red-social-btn:focus {
      transform: scale(1.11) rotate(-5deg);
      box-shadow: 0 3px 24px #80000024;
      border-color: #80000066;
    }
    .red-social-btn svg {
      width: 31px; height: 31px; display: block;
    }
  </style>
</head>
<body>
  <h1 id="vinoTitulo">Ficha del Vino</h1>
  <div class="vino-ficha">
    <img alt="Imagen del vino" id="vinoImagen" src=""/>
    <div class="vino-dato"><strong>Tipo:</strong> <span id="vinoTipo">-</span></div>
    <div class="vino-dato"><strong>Origen:</strong> <span id="vinoOrigen">-</span></div>
    <div class="vino-dato"><strong>Variedad:</strong> <span id="vinoUva">-</span></div>
    <div class="vino-dato"><strong>Bodega:</strong> <span id="bodegaNombre">-</span></div>
  </div>
  <!-- MÓDULO REDES SOCIALES MODERNO -->
  <div id="modulo-redes" class="modulo-redes">
    <div class="redes-scroll" id="redes-scroll">
      <!-- Aquí se pintarán los iconos vía JS -->
    </div>
  </div>
  <!-- MÓDULO COMPARTIR -->
  <div id="modulo-compartir">
    <button id="btn-compartir">Compartir ficha</button>
    <div id="menu-compartir" class=""></div>
  </div>

  <div id="radar-svg-container">
    <h3>Perfil organoléptico</h3>
    <div class="switch-buttons">
      <button id="btn-aromatico" class="active" onclick="renderRadar('aromatico')">Aromático</button>
      <button id="btn-gustativo" onclick="renderRadar('gustativo')">Gustativo</button>
      <button id="btn-sensorial" onclick="renderRadar('sensorial')">Sensorial</button>
    </div>
    <svg id="radarSVG" width="320" height="320" viewBox="0 0 320 320"></svg>
  </div>

  <div id="modulo-sommelier">
    <button id="hablar">Hablar con el sommelier</button>
    <div id="sommelier-aviso" style="display:none;">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="10" fill="#bbb"/><path d="M12 7v4m0 4h.01" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Para vivir la experiencia completa del Sommelier Virtual, escanea el QR en la botella.
    </div>
  </div>
  <div id="respuesta">Cargando descripción del vino...</div>

  <div id="score-container">
    <h3>Puntuación Total</h3>
    <div id="score-bar"><div id="score-fill" style="width: 0%">0</div></div>
    <div id="rating-summary" style="display: flex; align-items: center; gap: 0.5rem; margin-top: 1rem;">
      <span id="media-nota" style="font-size:2rem; font-weight:bold;">-</span>
      <span id="estrellas-nota" style="font-size:1.5rem; color: #800000;"></span>
      <span id="total-valoraciones" style="font-size:1rem; color:#555;"></span>
    </div>
  </div>

  <div id="valoracion-container">
    <h3>Valora este vino</h3>
    <div id="estrellas">
      <span class="estrella" data-value="1">★</span><span class="estrella" data-value="2">★</span><span class="estrella" data-value="3">★</span><span class="estrella" data-value="4">★</span><span class="estrella" data-value="5">★</span>
    </div>
    <textarea id="comentario" placeholder="Deja un comentario sobre el vino..." rows="4" style="width:100%; margin-top: 1rem; padding: 0.5rem;"></textarea>
    <button id="enviar-valoracion" style="margin-top: 1rem; background:#800000; color:white; border:none; padding:0.5rem 1rem; border-radius:0.5rem; cursor:pointer;">Enviar valoración</button>
    <p id="mensaje-valoracion" style="margin-top:1rem; color: green;"></p>
  </div>

  <div id="comentarios-container" style="margin-top: 3rem;">
    <h3 style="cursor:pointer; color:#800000;" onclick="toggleComentarios()">▼ Comentarios de otros usuarios</h3>
    <div id="lista-comentarios" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out;">
      <p style="padding: 1rem 0;">Cargando comentarios...</p>
    </div>
  </div>
<script>
let organo = {};
let puntuacionSeleccionada = 0;
const urlParams = new URLSearchParams(window.location.search);
const vinoId = urlParams.get("vino_id");
const esQR = urlParams.get("qr") === "1";

// --- ICONOS OFICIALES COLORIDOS SVG PARA REDES ---
const svgRedes = {
  web: `<svg viewBox="0 0 48 48"><circle fill="#4a90e2" cx="24" cy="24" r="24"/><path fill="#fff" d="M24 13a11 11 0 1 1 0 22 11 11 0 0 1 0-22zm0 2c-2.9 0-5.3 4.1-5.8 9.3h11.6C29.3 19.1 26.9 15 24 15zm-7.7 11c.2 2.6 1 5 2.2 6.6C19.7 29.8 21.7 31 24 31c2.3 0 4.3-1.2 5.5-3.4 1.2-1.6 2-4 2.2-6.6H16.3zm13.5-2c-.6-5.2-2.9-9.3-5.8-9.3s-5.2 4.1-5.8 9.3h11.6zm-13.7 2h-2.4A11 11 0 0 0 24 35c2.3 0 4.4-.6 6.2-1.7a12.5 12.5 0 0 1-2.5-3.3c-1.6 2.2-4.3 3.6-7.1 3.6a11 11 0 0 1-6.2-20.4C11.6 13 11.7 24 16.1 26zm18.3-2c-.2 2.6-1 5-2.2 6.6C28.3 29.8 26.3 31 24 31s-4.3-1.2-5.5-3.4c-1.2-1.6-2-4-2.2-6.6h11.6zm-11.8 2c.6 5.2 2.9 9.3 5.8 9.3s5.2-4.1 5.8-9.3H16.3z"/></svg>`,
  instagram: `<svg viewBox="0 0 48 48"><radialGradient id="IG" cx="24" cy="24" r="24" gradientUnits="userSpaceOnUse"><stop offset="0%" stop-color="#fd5"/><stop offset="100%" stop-color="#c837ab"/></radialGradient><circle fill="url(#IG)" cx="24" cy="24" r="24"/><rect fill="none" stroke="#fff" stroke-width="3" x="14" y="14" width="20" height="20" rx="7"/><circle fill="none" stroke="#fff" stroke-width="3" cx="24" cy="24" r="6"/><circle fill="#fff" cx="31" cy="17" r="2"/></svg>`,
  youtube: `<svg viewBox="0 0 48 48"><circle fill="#ff001d" cx="24" cy="24" r="24"/><polygon fill="#fff" points="20,17 34,24 20,31"/></svg>`,
  facebook: `<svg viewBox="0 0 48 48"><circle fill="#1977f3" cx="24" cy="24" r="24"/><path fill="#fff" d="M26.4 24v-3.3c0-.7.2-1.1 1.1-1.1h1.6v-3.5H27c-2 0-3 1-3 2.8v2h-2v3.3h2V31h3.4v-7z"/></svg>`,
  tiktok: `<svg viewBox="0 0 48 48"><circle fill="#191919" cx="24" cy="24" r="24"/><path d="M33 19.1c-2.3 0-4.2-1.7-4.5-4V15h-3.3v14.1a3.1 3.1 0 1 1-3.2-3.1c.2 0 .5.1.7.2V22.8c-.2 0-.4-.1-.7-.1a6.1 6.1 0 1 0 6.1 6.1v-7.6c1.4 1 3.1 1.7 4.9 1.7V19.1z" fill="#fff"/><path d="M34 16.6c-2.4 0-4.4-2-4.4-4.4h-1.6c0 3.3 2.7 6 6 6v-1.6z" fill="#00f2ea"/><path d="M28 27.5a3.2 3.2 0 1 1-3.3-3.1c.2 0 .5.1.7.2v-1.7c-.2 0-.4-.1-.7-.1a6.1 6.1 0 1 0 6.1 6.1v-1.6c-1.7 0-3.3-.6-4.5-1.8v2z" fill="#ff004f"/></svg>`,
  twitter: `<svg viewBox="0 0 48 48"><circle fill="#1da1f2" cx="24" cy="24" r="24"/><path fill="#fff" d="M36 17.6a8.3 8.3 0 0 1-2.4.6 4.1 4.1 0 0 0 1.8-2.3c-.7.5-1.5.9-2.4 1.1a4.1 4.1 0 0 0-7 3.8A11.6 11.6 0 0 1 15 16.2a4 4 0 0 0 1.3 5.5c-.6 0-1.1-.2-1.6-.4v.1a4.1 4.1 0 0 0 3.3 4c-.2 0-.3.1-.5.1a3.3 3.3 0 0 1-.8-.1 4.1 4.1 0 0 0 3.8 2.9A8.2 8.2 0 0 1 14 29c-.5 0-1.1 0-1.6-.1a11.6 11.6 0 0 0 6.3 1.9c7.6 0 11.7-6.2 11.7-11.7v-.5a8.4 8.4 0 0 0 2.1-2.2z"/></svg>`,
  linkedin: `<svg viewBox="0 0 48 48"><circle fill="#0077b5" cx="24" cy="24" r="24"/><rect fill="#fff" x="16" y="20" width="2.7" height="8"/><rect fill="#fff" x="21" y="20" width="2.7" height="8"/><path fill="#fff" d="M24.5 19.5c.7 0 1.2-.5 1.2-1.2S25.2 17 24.5 17 23.3 17.5 23.3 18.3s.5 1.2 1.2 1.2zm0 0z"/><rect fill="#fff" x="16" y="28" width="2.7" height="2.7"/><rect fill="#fff" x="21" y="28" width="2.7" height="2.7"/><path fill="#fff" d="M27.5 20H25v8h2.5v-4.3c0-2.5 3-2.7 3 0v4.3H33v-4.7c0-4-4.5-3.8-5.5-1.9V20z"/></svg>`,
  pinterest: `<svg viewBox="0 0 48 48"><circle fill="#e60023" cx="24" cy="24" r="24"/><path fill="#fff" d="M24 15a8.6 8.6 0 0 0-3.7 16.4c-.1-.8-.2-2.2.1-3.1.3-.9 2-5.9 2-5.9s-.5-1-0.5-2.4c0-2.2 1.3-3.9 3-3.9 1.4 0 2.1 1.1 2.1 2.4 0 1.5-.9 3.8-1.4 5.9-.4 1.6.8 2.9 2.4 2.9 2.9 0 4.8-3.7 4.8-8.1 0-3.3-2.2-5.8-6.3-5.8zm-7.7 14.2c-1.5-.2-2.9-1.5-3.2-3.1-.6-2.2.7-4.3 2.9-4.7a7.5 7.5 0 0 1 1.2 7.8z"/></svg>`
};

function renderRedesSociales(bodega) {
  const mapping = {
    web: 'web',
    instagram: 'instagram',
    youtube: 'youtube',
    facebook: 'facebook',
    tiktok: 'tiktok',
    twitter: 'twitter',
    linkedin: 'linkedin',
    pinterest: 'pinterest'
  };
  const redesHtml = [];
  Object.keys(mapping).forEach(key => {
    const url = bodega[mapping[key]];
    if (url) {
      redesHtml.push(
        `<a class="red-social-btn" href="${url}" target="_blank" rel="noopener noreferrer" aria-label="${key}">
          ${svgRedes[key] || ""}
        </a>`
      );
    }
  });
  document.getElementById("redes-scroll").innerHTML = redesHtml.join('');
}

// --- Resto de JS: radar, cargar ficha, comentarios, etc ---

const perfiles = {
  aromatico: { labels: ["Fruta", "Floral", "Especiado", "Tostado", "Herbáceo"], lados: 5 },
  gustativo: { labels: ["Cuerpo", "Acidez", "Dulzor", "Taninos", "Frescura", "Mineralidad"], lados: 6 },
  sensorial: { labels: ["Persistencia", "Complejidad", "Astringencia", "Alcohol", "Armonía"], lados: 5 }
};
let radarActivo = "aromatico";
window.renderRadar = function(tipo) {
  radarActivo = tipo;
  document.querySelectorAll('.switch-buttons button').forEach(btn => btn.classList.remove('active'));
  document.getElementById(`btn-${tipo}`).classList.add('active');
  renderRadarSVG(tipo);
};
function renderRadarSVG(tipo) {
  const datos = organo;
  const { labels, lados } = perfiles[tipo];
  const valores = labels.map(lab => (organo[toKey(lab)] ?? 0));
  const radarSVG = document.getElementById("radarSVG");
  radarSVG.innerHTML = '';
  const size = 320, radio = 110, centro = size / 2, niveles = 5;
  for(let lvl=1; lvl<=niveles; lvl++){
    const r = radio * lvl/ niveles;
    radarSVG.innerHTML += `<circle cx="${centro}" cy="${centro}" r="${r}" fill="none" stroke="#d7b6b6" stroke-width="1"/>`;
  }
  for(let i=0; i<lados; i++){
    const ang = (Math.PI*2/lados)*i - Math.PI/2;
    const x = centro + radio*Math.cos(ang);
    const y = centro + radio*Math.sin(ang);
    radarSVG.innerHTML += `<line x1="${centro}" y1="${centro}" x2="${x}" y2="${y}" stroke="#e9dada" stroke-width="1"/>`;
    const lx = centro + (radio+24)*Math.cos(ang);
    const ly = centro + (radio+24)*Math.sin(ang)+6;
    radarSVG.innerHTML += `<text class="radar-label" x="${lx}" y="${ly}">${labels[i]}</text>`;
  }
  let points = "";
  for(let i=0; i<lados; i++){
    const val = Math.max(0,Math.min(10,parseFloat(valores[i]||0)));
    const ang = (Math.PI*2/lados)*i - Math.PI/2;
    const rVal = radio * (val/10);
    const px = centro + rVal * Math.cos(ang);
    const py = centro + rVal * Math.sin(ang);
    points += `${px},${py} `;
  }
  radarSVG.innerHTML += `<polygon points="${points.trim()}" fill="rgba(128,0,0,0.21)" stroke="#800000" stroke-width="2"/>`;
  radarSVG.innerHTML += `<circle cx="${centro}" cy="${centro}" r="4.8" fill="#800000"/>`;
}
function toKey(str){
  return str.toLowerCase().replace(/á/g,"a").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ñ/g,"n").replace(/\s/g,"_");
}

function calcularPuntuacionTotal() {
  let total = 0;
  for (const key in organo) total += parseInt(organo[key]) || 0;
  const maxScore = Object.keys(organo).length * 10;
  const porcentaje = maxScore > 0 ? Math.round((total / maxScore) * 100) : 0;
  const fill = document.getElementById("score-fill");
  fill.style.width = porcentaje + "%";
  fill.innerText = porcentaje + " / 100";
}
function renderEstrellas(nota) {
  const contenedor = document.getElementById("estrellas-nota");
  contenedor.innerHTML = "";
  const estrellas = Math.floor(nota);
  const media = nota - estrellas;
  for (let i = 1; i <= 5; i++) {
    if (i <= estrellas) contenedor.innerHTML += "★";
    else if (i === estrellas + 1 && media >= 0.25 && media < 0.75) contenedor.innerHTML += "⯪";
    else contenedor.innerHTML += "☆";
  }
}

async function cargarFichaVino() {
  try {
    const fichaData = await (await fetch(`https://sommelierlab-api-production.up.railway.app/api/vino/${vinoId}` )).json();
    document.getElementById("vinoImagen").src = fichaData.imagen?.[0]?.url || "";
    document.title = document.getElementById("vinoTitulo").innerText = fichaData.nombre || "Ficha del Vino";
    document.getElementById("vinoTipo").innerText = fichaData.tipo;
    document.getElementById("vinoUva").innerText = fichaData.variedad;
    document.getElementById("vinoOrigen").innerText = fichaData.origen;
    document.getElementById("bodegaNombre").innerText = fichaData.bodega?.nombre || "";
    // --- Renderizado de redes sociales aquí ---
    renderRedesSociales(fichaData.bodega || {});
  } catch (error) { console.error("❌ Error cargando la ficha del vino:", error); }
}

async function cargarPerfilOrganoleptico() {
  try {
    organo = await (await fetch(`https://sommelierlab-api-production.up.railway.app/api/organoleptica/${vinoId}` )).json();
    renderRadar(radarActivo);
    calcularPuntuacionTotal();
  } catch (error) { console.error("❌ Error cargando el perfil organoléptico:", error); }
}

async function cargarNarrativaVino() {
  try {
    const dataCerebro = await (await fetch(`https://n8n-production-cb18.up.railway.app/webhook/consultar-vino?vino_id=${vinoId}` )).json();
    document.getElementById("respuesta").innerText = dataCerebro.narrativa || "No se pudo generar la narrativa del vino.";
  } catch (error) { console.error("❌ Error cargando la narrativa del vino:", error); }
}

async function cargarResumenValoraciones() {
  try {
    const data = await (await fetch(`https://n8n-production-cb18.up.railway.app/webhook/consultar-valoraciones?vino_id=${vinoId}` )).json();
    if (data.total_valoraciones > 0) {
      document.getElementById("rating-summary").style.display = "flex";
      document.getElementById("media-nota").innerText = data.nota_media.toFixed(1);
      renderEstrellas(data.nota_media);
      document.getElementById("total-valoraciones").innerText = `(${data.total_valoraciones} valoraciones)`;
    }
  } catch (error) { console.error("Error al cargar resumen de valoraciones:", error); }
}

// --- COMENTARIOS ---
const listaComentariosEl = document.getElementById("lista-comentarios");
window.toggleComentarios = function() {
  if (listaComentariosEl.style.maxHeight === "0px" || !listaComentariosEl.style.maxHeight) {
    listaComentariosEl.style.maxHeight = listaComentariosEl.scrollHeight + "px";
  } else {
    listaComentariosEl.style.maxHeight = "0px";
  }
}
function formatearFecha(fechaStr) {
  return new Date(fechaStr).toLocaleDateString("es-ES", { year: "numeric", month: "long", day: "numeric" });
}
async function cargarComentarios() {
  try {
    const data = await (await fetch(`https://n8n-production-cb18.up.railway.app/webhook/consultar-comentarios?vino_id=${vinoId}` )).json();
    const comentarios = Array.isArray(data.comentarios) ? data.comentarios : Array.isArray(data) ? data : [];
    listaComentariosEl.innerHTML = "";
    if (comentarios.length === 0) {
      listaComentariosEl.innerHTML = '<p style="padding: 1rem 0;">No hay comentarios aún. ¡Sé el primero en opinar!</p>';
    } else {
      comentarios.slice(0, 10).forEach(c => {
        const div = document.createElement("div");
        div.className = "comentario";
        div.innerHTML = `<strong style="color:#800000;">${c.ciudad || "Usuario anónimo"}</strong> · <span style="color: #666;">${formatearFecha(c.fecha)}</span>  
<em>“${c.comentario}”</em>`;
        listaComentariosEl.appendChild(div);
      });
    }
    if (listaComentariosEl.style.maxHeight !== "0px" && listaComentariosEl.style.maxHeight !== "") {
      listaComentariosEl.style.maxHeight = listaComentariosEl.scrollHeight + "px";
    }
  } catch (error) {
    console.error("Error al cargar o procesar comentarios:", error);
    listaComentariosEl.innerHTML = "<p>No se pudieron cargar los comentarios.</p>";
  }
}

// --- INICIALIZACIÓN Y EVENTOS ---
if (!vinoId) {
  document.getElementById("respuesta").innerText = "No se especificó ningún vino.";
} else {
  fetch("https://ipapi.co/json/")
    .then(response => response.json())
    .then(data => {
      window._datosUsuario = { ciudad: data.city, pais: data.country_name, idioma: navigator.language };
    })
    .catch(error => {
      console.warn("No se pudo obtener geolocalización:", error);
      window._datosUsuario = {};
    })
    .finally(() => {
      document.querySelectorAll(".estrella").forEach(e => {
        e.addEventListener("click", () => {
          puntuacionSeleccionada = parseInt(e.dataset.value);
          document.querySelectorAll(".estrella").forEach(star => {
            star.classList.toggle("seleccionada", parseInt(star.dataset.value) <= puntuacionSeleccionada);
          });
        });
      });
      document.getElementById("enviar-valoracion").addEventListener("click", async () => {
        const comentario = document.getElementById("comentario").value || "";
        const mensaje = document.getElementById("mensaje-valoracion");
        if (!puntuacionSeleccionada) {
          mensaje.innerText = "Por favor, selecciona una puntuación (de 1 a 5 estrellas).";
          mensaje.style.color = "red";
          return;
        }
        try {
          await fetch("https://n8n-production-cb18.up.railway.app/webhook/comentar-vino", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              vino_id: vinoId,
              puntuacion: puntuacionSeleccionada,
              comentario: comentario,
              user_id: localStorage.getItem("user_id" ) || "user_" + Math.random().toString(36).substring(2, 10),
              ciudad: window._datosUsuario?.ciudad || "Desconocida",
              pais: window._datosUsuario?.pais || "Desconocido",
              idioma: window._datosUsuario?.idioma || "es"
            })
          });
          mensaje.innerText = "¡Gracias por tu valoración!";
          mensaje.style.color = "green";
        } catch (err) {
          mensaje.innerText = "Error al enviar tu valoración.";
          mensaje.style.color = "red";
        }
      });

      // SOMMELIER ACCESO PRO O BLOQUEADO SEGÚN QR
      const btnHablar = document.getElementById("hablar");
      const avisoSommelier = document.getElementById("sommelier-aviso");
      if (esQR) {
        btnHablar.disabled = false;
        btnHablar.style.opacity = 1;
        btnHablar.style.pointerEvents = "auto";
        avisoSommelier.style.display = "none";
      } else {
        btnHablar.disabled = true;
        btnHablar.style.opacity = 0.6;
        btnHablar.style.pointerEvents = "none";
        avisoSommelier.style.display = "flex";
      }

      // --- CARGA DE DATOS DE LA PÁGINA ---
      cargarFichaVino();
      cargarPerfilOrganoleptico();
      cargarNarrativaVino();
      cargarResumenValoraciones();
      cargarComentarios();
    });
}
</script>
</body>
</html>
